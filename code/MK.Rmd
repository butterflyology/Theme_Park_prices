---
title: "Magic Kingdom Ticket Prices"
author: "Chris Hamm"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
    toc_depth: 3
 # pdf_document:
 #   toc: true
 #   number_sections: true
 #   fig_caption: yes
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.align = "center")
```

# Introduction
Trips to Walt Disney World are expensive and one of the more frustration things is the price of a ticket. It seems that every few months we hear about another hike for the cost of tickets. With the recent news that [variable pricing](http://time.com/money/5405838/disney-world-ticket-prices-2018/) for tickets is one the way I wanted to take a look at the history of the cost of a single day admission to the Magic Kingdom and ask a few quesitons:

1. Has the rate of increase gotten higher recently?
1. Did the different Disney CEOs raise ticket prices at different rates? 
1. Adjusted for inflation, does it cost more to visit Walt Disney World's Magic Kingdom today than it did in 1971? 

### TL;DR

1. Yes, the admission price under Bob Iger is increasing faster than it did under Michael Eisner.
1. No, we can't tell them apart but this is due to statistical issues with the number of increases made under each CEO. 
1. Yes. Yes. Yes. Adjusted for inflation, the cost of a one-day ticket to the Magic Kingdom in 1971 was \$21.65 and today it is approximately \$120.


# Data

To ask these questions I needed data. I needed data on the historic price of admission to the Magic Kingdom, and also the dates those tickets prices were in effect and the Disney CEO at the time. It wasn't hard to find websites with the history of admission prices. Whenever possible, I selected the most expensive ticket available that was not a park hopper. I used the data from this [site](http://allears.net/walt-disney-world/wdw-planning/wdw-ticket-increase-guide/) and cross referenced it [here](https://www.travelandleisure.com/trip-ideas/disney-vacations/disney-world-ticket-costs-over-time). I got the dates for the Disney CEOs from the book [Disney War](https://en.wikipedia.org/wiki/DisneyWar) by James B. Stewart and cross referenced them with this [Wikipedia article](https://en.wikipedia.org/wiki/List_of_management_of_The_Walt_Disney_Company). If I included the wrong data in this post, please let me know and point me to your source so I can correct the record.

Because this is a data science blog post, I've posted the code to a [repository](https://github.com/butterflyology/Theme_Park_prices) so that anyone with a computer can recreate the analyses presented here.


```{r prelims, echo = FALSE, results = FALSE, message = FALSE}
# Take care of some preliminaries, set the random number seed and load libraries we will use.
set.seed(982352)
options("getSymbols.warning4.0" = FALSE)

library("tidyverse") # This is a "meta-package" that contains lots of other useful packages, like ggplot2 and readr.
library('kableExtra') # We will use this to generate a nice looking table in `html`.
library("lubridate") # we will need some functions from here to work with date data
library("quantmod") # we will use this to get consumer price index data
library("magicfor") # package to save output from a for loop
library("gridExtra") # To plot multiple plots in one pane
```


Let's take a look at the data set I created. There are three columns in the data set:

1. `Date` - The date the admission price was in effect.
1. `Price` - The cose of single-day admission to the Magic Kingdom
1. `CEO` - The Disney CEO at the time of the price.

```{r import, echo = FALSE}
data <- read_csv("../data/MK_prices.csv", col_names = TRUE, col_types = cols(Date = col_date("%Y-%m-%d"), Price = col_double(), CEO = col_character()))

col_names <- c("Date", "Price (USD)", "CEO")
knitr::kable(x = data, format = "html", align = "c", col.names = col_names) %>%
  row_spec(row = 1:2, align = "c") %>% 
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE) %>%
  scroll_box(width = "650px", height = "300px")
```


# Visualize

You always want to look at the data. Here are the dates of the admission price on the horizontal axis (x-axis) and the cost of admission to the Magic Kingdom on the vertical axis (y-axis) in US Dollars.

```{r plot_1, echo = FALSE, results = FALSE}
prices <- data %>% 
  ggplot(aes(x = Date, y = Price, col = CEO)) +
  geom_point(size = 2.5) +
  scale_color_discrete(breaks = c("Disney", "Tatum", "Walker", "Miller", "Eisner", "Iger")) +
  theme_bw() + 
  theme(legend.position = c(0.15, 0.75), legend.text = element_text(size = 15)) +
  labs(y = "Price (USD)") + 
  coord_cartesian(ylim = c(0, 130))
prices
```

Does it look like Mr. Iger has upped the rate of admission increases faster than the other CEOs? Maybe. But this isn't an apples to apples comparison. This is nice and all but isn't as informative as we need for a meaningful inference. We need to adjust the prices for inflation. We will adjust inflation using the "Consumer Price Index for All Urban Consumers: All Items" from the rockstars over at the Bureau of Labor Statistics.

We will pull out the Consumer Price Index (CPI) for the dates the admission prices went into effect and normalize them based on a 1971 baseline (the year WDW opened). Then we will join these values and convert the older prices to 2018 US Dollars. We could go to a website like the St. Louis Federal Reserve Bank and manually look up the adjustments, but why do that when we could write code?

We've added three new columns to out dataset:

1. `Year` - We used this column to calculate the CPI
1. `Adjustment` - The adjusted CPI value
1. `Adjusted Price` - The original `Price` of a ticket times the `Adjustment`.


```{r CPI, warning = FALSE, echo = FALSE, results = "hide"}
getSymbols("CPIAUCSL", src = "FRED")
str(CPIAUCSL)

avg.cpi <- apply.yearly(CPIAUCSL, mean)
avg_cpi <- data.frame(Date = index(avg.cpi), avg.cpi)
rownames(avg_cpi) <- NULL
avg_cpi <- avg_cpi %>% 
  mutate(Year = year(Date)) %>%
  select(-Date)

# Inelegant, but it works, add a column with the year to our data set, we will join by this column
new_data <- data %>% 
  mutate(Year = year(Date))
magic_for(print, silent = TRUE)
for(year in new_data$Year){
  print(tail(avg_cpi$CPIAUCSL / avg_cpi[avg_cpi$Year == year, 1], 1))
}
adjustment <- magic_result_as_dataframe() 
colnames(adjustment) <- c("Year", "ADJ")

newer_data <- left_join(x = new_data, y = adjustment, by = "Year")
newer_data <- newer_data %>% 
  mutate(ADJ_Price = Price * ADJ)
```

```{r newer_data, echo = FALSE}
newer_col_names <- c("Date", "Price (USD)", "CEO", "Year", "Adjustment", "Adjusted Price (USD)" )
knitr::kable(x = newer_data, format = "html", align = "c", col.names = newer_col_names) %>%
  row_spec(row = 1:2, align = "c") %>% 
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE) %>%
  scroll_box(width = "650px", height = "300px")
```


Now we have our admission prices adjusted for inflation. Let's plot:

```{r adj_plot, echo = FALSE}
newer <- newer_data %>% 
  ggplot(aes(x = Date, y = ADJ_Price, col = CEO)) +
  geom_point(size = 2.5) +
  scale_color_discrete(breaks = c("Disney", "Tatum", "Walker", "Miller", "Eisner", "Iger")) +
  theme_bw() + 
  theme(legend.position = c(0.15, 0.75), legend.text = element_text(size = 15)) +
  labs(y = "Adjusted Price (USD)") +
  coord_cartesian(ylim = c(0, 130))
newer

# ggplot_build(newer)$data # This pulls out data from the plot so we can see what color went with each point. 
```


It may be beneficial to see the adjusted prices side by side with the original prices. 

```{r side_by_side, echo = FALSE}
prices <- prices + 
  theme(legend.position = c(0.25, 0.75), legend.text = element_text(size = 15))
newer <- newer +
  theme(legend.position = c(0.25, 0.75), legend.text = element_text(size = 15))

grid.arrange(prices, newer, ncol = 2)
```



What kind of blows my mind is that the Magic Kingdom's prices have, on occasion, not kept up with inflation. I'm sure that Disney management would take that to mean they haven't raised prices enough. When I saw this I went and manually checked the adjustments I calculated using the Bureau of Labor Statistics own [calculator](https://data.bls.gov/cgi-bin/cpicalc.pl) and I was pretty close each time. Certainly, the trends observed in the data hold up.

On to the questions.

# Question 1

The first two questions are related. To refresh your recollection: 

1. Has the rate of increase gotten higher recently?

Let's look at the rate of increase for each CEO. We will fit a straight line through each CEOs prices and use that line to describe each pricing regime. For those playing along at home, this is called a linear regression. We will use the same plot as before and overlay the lines to it. Roy O. Disney was CEO for only one price point and won't get a line. 


```{r lines, echo = FALSE, warning = FALSE}
newer_data %>% 
  ggplot(aes(x = Date, y = ADJ_Price, col = CEO)) +
  geom_point(size = 2.5) +
  scale_color_discrete(breaks = c("Disney", "Tatum", "Walker", "Miller", "Eisner", "Iger")) +
  theme_bw() + 
  theme(legend.position = c(0.15, 0.75), legend.text = element_text(size = 15)) +
  labs(y = "Adjusted Price (USD)") +
  coord_cartesian(ylim = c(0, 130)) +
  geom_smooth(method = "lm", formula = y ~ x, se = TRUE, show.legend = FALSE, level = 0.95)
```


The shaded reagions around the lines represent the confidence interval around the line.

The steepness of the lines is what we are interested in. Are the slopes between Michael Eisner and Bob Iger the same? They don't appear to be the same but I want to check.


```{r ancova, echo = FALSE, results = FALSE}
# create a data set that contains just the Eisner and Iger rows
Eisner_Iger <- newer_data %>% 
  filter(CEO == "Eisner" | CEO == "Iger")

# a model with the interaction term
mod1 <- aov(ADJ_Price ~ Date * CEO, data = Eisner_Iger)
summary(mod1)

# a model without the interaction term
mod2 <- aov(ADJ_Price ~ Date + CEO, data = Eisner_Iger)
summary(mod2)

anova(mod1, mod2)
# Removing the interaction term shows that does significantly affect the model. But we don't know how the slope changes.


# We need to further parse the data and run a linear regression for the two most recent CEOs
Eisner <- newer_data %>%
  filter(CEO == "Eisner")

Iger <- newer_data %>%
  filter(CEO == "Iger")

lm_Eisner <- lm(ADJ_Price ~ Date, data = Eisner)
lm_Iger <- lm(ADJ_Price ~ Date, data = Iger)

summary(lm_Eisner)
summary(lm_Iger)
# The slopes are very different indeed.


# Manually change colors to match previous plots
Eisner_Iger %>%
  ggplot(aes(x = Date, y = ADJ_Price, col = CEO)) +
  geom_point(size = 2.5) +
  labs(y = "Adjusted Price (USD)") +
  geom_smooth(method = "lm", formula = y ~ x, se = TRUE, show.legend = FALSE, level = 0.95) +
  theme_bw() +
  theme(legend.position = c(0.15, 0.75), legend.text = element_text(size = 15)) +
  scale_color_manual(values = c("#B79F00", "#00BA38"))
```


# Question 2
Did the different Disney CEOs raise ticket prices at different rates? 

Looking at the adjusted for inflation figure, it does seem that the different CEOs raised ticket prices differently. If we ask this all at the same time the answer is suprisingly, no. But this has more to do with the number of data points we have and the fact that the CEOs raised prices a different number of times. For example, there were two price changes during Ron Miller's (brief) tenure, and Michael Eisner oversaw 31 price increases. Statistically speaking, this reduces our ability to say things about the data.

```{r CEOs, echo = FALSE, results = "hide"}
lm1 <- lm(ADJ_Price ~ Date + CEO, data = newer_data)
summary(lm1)
```


# Question 3
Adjusted for inflation, does it cost more to visit Disney today than it did in 1971? 

Yes. Yes. Yes. Adjusted for inflation, the cost of admission to the Magic Kingdom in 1971 was $21.64. The cost of admission on of October 13th, 2018 is \$122. 
